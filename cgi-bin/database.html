#!/usr/bin/python


import sqlite3
import datetime


# get signature
f = open('webfiles/config')
dataFile = f.readlines()[0] + "Data.db"
f.close() 

# connect to local database file
connection = sqlite3.connect("data/" + dataFile)
connectionCursor = connection.cursor()


# HTTP header
print "Content-Type: text/html"
print ""

print "<!DOCTYPE html>"
print "<html>"

print "<head>"
print "<title>lokiNET (database)</title>"
print "<link rel=\"stylesheet\" href=\"//code.jquery.com/ui/1.11.3/themes/smoothness/jquery-ui.css\">"
print "<link rel=\"stylesheet\" type=\"text/css\" href=\"//cdn.datatables.net/plug-ins/1.10.6/integration/jqueryui/dataTables.jqueryui.css\">"
print "<link rel=\"stylesheet\" type=\"text/css\" href=\"../webfiles/style.css\">"
print "<script src=\"//code.jquery.com/jquery-1.10.2.js\"></script>"
print "<script src=\"//code.jquery.com/ui/1.11.3/jquery-ui.js\"></script>"
print "<script type=\"text/javascript\" language=\"javascript\" src=\"//cdn.datatables.net/1.10.6/js/jquery.dataTables.min.js\"></script>"
print "<script type=\"text/javascript\" language=\"javascript\" src=\"//cdn.datatables.net/plug-ins/1.10.6/integration/jqueryui/dataTables.jqueryui.js\"></script>"
print "<script>"
print "$(function() {"
print "$( document ).tooltip({"
print "track: true"
print "});"
print "$( \"#tabs\" ).tabs()"
print "});"
print "$(document).ready(function() {"
print "$('#aps').dataTable();"
print "$('#cps').dataTable();"
print "$('#cns').dataTable();"
print "});"
print "</script>"
print "</head>"
print "<body id=\"bodyLogin\">"
print "<table border=\"0\" id=\"creationTable\" style=\"left: 20%; top: 5%; width: 60%\">"
print "<tr><td height=\"20%\"><img src=\"../webfiles/logo.png\" width=\"50%\"></td></tr>"
print "<tr>"
print "<td>"
print "<table border=\"0\" style=\"background: #d3d3d3; border-radius: 5px; width: 1024px;\">"
print "<tr><td colspan=\"2\">"

print "<div id=\"tabs\">"
print "<ul>"
print "<li><a href=\"#tabs-1\">Access Points</a></li>"
print "<li><a href=\"#tabs-2\">Client Probes</a></li>"
print "<li><a href=\"#tabs-3\">Connections</a></li>"
print "</ul>"
print "<div id=\"tabs-1\">"

print "<div class=\"container\">"
print "<table id=\"aps\" class=\"display\" cellspacing=\"0\">"
print "<thead><tr><th><div id=\"fontDiv\">Scrambled BSSID</div></th><th><div id=\"fontDiv\">Scrambled ESSID</div></th><th><div id=\"fontDiv\">Channel</div></th><th><div id=\"fontDiv\">Power</div></th><th><div id=\"fontDiv\">Encryption</div></th><th><div id=\"fontDiv\">Time</div></th><th><div id=\"fontDiv\">Location</div></th></tr></thead>"
print "<tbody>"
statement = "select bssid, essid, channel, power, encryption, time, locationId from accesspoints"
connectionCursor.execute(statement)
allAccessPoints = connectionCursor.fetchall()
for i in range(0, len(allAccessPoints)):
    print "<tr>"
    print "<td><div id=\"fontDiv\">" + str(allAccessPoints[i][0]) + "</div></td><td><div id=\"fontDiv\">" + str(allAccessPoints[i][1]) + "</div></td><td><div id=\"fontDiv\">" + str(allAccessPoints[i][2]) + "</div></td><td><div id=\"fontDiv\">" + str(allAccessPoints[i][3]) + "</div></td><td><div id=\"fontDiv\">" + str(allAccessPoints[i][4]) + "</div></td><td><div id=\"fontDiv\">" + str(datetime.datetime.fromtimestamp(float(allAccessPoints[i][5])).strftime("%Y-%m-%d %H:%M:%S")) + "</div></td><td><div id=\"fontDiv\">" + str(allAccessPoints[i][6]) + "</div></td>"       
    print "</tr>"
print "</tbody>"
print "</table>"
print "</div>"

print "</div>"
print "<div id=\"tabs-2\">"
print "<div class=\"container\">"
print "<table id=\"cps\" class=\"display\" cellspacing=\"0\">"
print "<thead><tr><th><div id=\"fontDiv\">Scrambled MAC</div></th><th><div id=\"fontDiv\">Scrambled Probe</div></th><th><div id=\"fontDiv\">Power</div></th><th><div id=\"fontDiv\">First Seen</div></th><th><div id=\"fontDiv\">Last Seen</div></th><th><div id=\"fontDiv\">Location</div></th></tr></thead>"
print "<tbody>"
statement = "select clientMac, probe, power, timeFirst, timeLast, locationId from clientProbes"
connectionCursor.execute(statement)
allAccessPoints = connectionCursor.fetchall()
for i in range(0, len(allAccessPoints)):
    print "<tr>"
    print "<td><div id=\"fontDiv\">" + str(allAccessPoints[i][0]) + "</div></td><td><div id=\"fontDiv\">" + str(allAccessPoints[i][1]) + "</div></td><td><div id=\"fontDiv\">" + str(allAccessPoints[i][2]) + "</div></td><td><div id=\"fontDiv\">" + str(datetime.datetime.fromtimestamp(float(allAccessPoints[i][3])).strftime("%Y-%m-%d %H:%M:%S")) + "</div></td><td><div id=\"fontDiv\">" + str(datetime.datetime.fromtimestamp(float(allAccessPoints[i][4])).strftime("%Y-%m-%d %H:%M:%S")) + "</div></td><td><div id=\"fontDiv\">" + str(allAccessPoints[i][5]) + "</div></td>"
    print "</tr>"
print "</tbody>"
print "</table>"
print "</div>"
print "</div>"

print "<div id=\"tabs-3\">"
print "<div class=\"container\">"
print "<table id=\"cns\" class=\"display\" cellspacing=\"0\">"
print "<thead><tr><th><div id=\"fontDiv\">Scrambled MAC One</div></th><th><div id=\"fontDiv\">Scrambled MAC Two</div></th><th><div id=\"fontDiv\">Power</div></th><th><div id=\"fontDiv\">First Seen</div></th><th><div id=\"fontDiv\">Last Seen</div></th><th><div id=\"fontDiv\">Location</div></th></tr></thead>"
print "<tbody>"
statement = "select macOne, macTwo, power, timeFirst, timeLast, locationId from connections"
connectionCursor.execute(statement)
allAccessPoints = connectionCursor.fetchall()
for i in range(0, len(allAccessPoints)):
    print "<tr>"
    print "<td><div id=\"fontDiv\">" + str(allAccessPoints[i][0]) + "</div></td><td><div id=\"fontDiv\">" + str(allAccessPoints[i][1]) + "</div></td><td><div id=\"fontDiv\">" + str(allAccessPoints[i][2]) + "</div></td><td><div id=\"fontDiv\">" + str(datetime.datetime.fromtimestamp(float(allAccessPoints[i][3])).strftime("%Y-%m-%d %H:%M:%S")) + "</div></td><td><div id=\"fontDiv\">" + str(datetime.datetime.fromtimestamp(float(allAccessPoints[i][4])).strftime("%Y-%m-%d %H:%M:%S")) + "</div></td><td><div id=\"fontDiv\">" + str(allAccessPoints[i][5]) + "</div></td>"
    print "</tr>"
print "</tbody>"
print "</table>"
print "</div>"
print "</div>"
print "</div>"

print "</td></tr>"
print "<tr><td width=\"20%\"><input style=\"display: block; width: 100%;\" id=\"loginButton\" onclick=\"window.location.href='menu.html'\" type=\"button\" value=\"back\"></td><td></td></tr>"
print "</table>"
print "</body>"
print "</html>"
